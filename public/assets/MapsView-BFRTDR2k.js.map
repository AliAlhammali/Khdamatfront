{"version":3,"file":"MapsView-BFRTDR2k.js","sources":["../../src/components/common/MapsView.vue"],"sourcesContent":["<template>\r\n  <div\r\n    class=\"position-relative w-100\"\r\n    id=\"leafletmap\"\r\n    :key=\"`${points[0]}-${points[1]}`\"\r\n  >\r\n    <l-map\r\n      ref=\"map\"\r\n      :zoom=\"zoom\"\r\n      :center=\"points\"\r\n      :global-leaflet=\"false\"\r\n      :style=\"styleMap\"\r\n    >\r\n      <l-tile-layer\r\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        layer-type=\"base\"\r\n        name=\"OpenStreetMap\"\r\n      ></l-tile-layer>\r\n      <l-marker\r\n        :lat-lng=\"points\"\r\n        :update:visible=\"true\"\r\n        :draggable=\"isEditMode\"\r\n        @dragend=\"updateCenter($event)\"\r\n      ></l-marker>\r\n    </l-map>\r\n  </div>\r\n</template>\r\n<script >\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport \"leaflet-geosearch/dist/geosearch.css\";\r\n\r\nimport { LMap, LTileLayer, LMarker } from \"@vue-leaflet/vue-leaflet\";\r\nimport { GeoSearchControl, OpenStreetMapProvider } from \"leaflet-geosearch\";\r\n\r\nexport default {\r\n  props: {\r\n    center: {\r\n      type: Array,\r\n      default: () => [47.41322, -1.219482],\r\n    },\r\n    style: {\r\n      type: Object,\r\n      default: () => ({}),\r\n    },\r\n    zoom: {\r\n      type: Number,\r\n      default: 16,\r\n    },\r\n    isEditMode: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  components: {\r\n    LMap,\r\n    LTileLayer,\r\n    LMarker,\r\n  },\r\n  data() {\r\n    return {\r\n      points: [0, 0],\r\n      address: {\r\n        title: \"\",\r\n        lat: \"\",\r\n        long: \"\",\r\n      },\r\n    };\r\n  },\r\n  created() {\r\n    this.points = this.center;\r\n  },\r\n  mounted() {\r\n    this.$nextTick(() => {\r\n      if (this.isEditMode) {\r\n        this.initMapBySearch();\r\n      }\r\n    });\r\n  },\r\n  computed: {\r\n    styleMap() {\r\n      return {\r\n        height: this.style.height || \"400px\",\r\n        width: this.style.width || \"100%\",\r\n      };\r\n    },\r\n  },\r\n  methods: {\r\n    updateCenter(event) {\r\n      this.points = [event.target._latlng.lat, event.target._latlng.lng];\r\n      this.findAddressByCoordinates();\r\n    },\r\n    findAddressByCoordinates() {\r\n      const provider = new OpenStreetMapProvider();\r\n      fetch(\r\n        `${provider.searchUrl}?q=${this.points[0]},${this.points[1]}&polygon_geojson=1&format=json`\r\n      )\r\n        .then((response) => response.json())\r\n        .then((data) => {\r\n          this.address = {\r\n            title: data[0]?.display_name,\r\n            lat: data[0]?.lat,\r\n            long: data[0]?.lon,\r\n          };\r\n          this.$emit(\"getLocation\", this.address);\r\n        });\r\n    },\r\n    initMapBySearch() {\r\n      const provider = new OpenStreetMapProvider({\r\n        params: {\r\n          countrycodes: \"SA\",\r\n        },\r\n      });\r\n      const searchControl = new GeoSearchControl({\r\n        provider: provider,\r\n        notFoundMessage: \"Sorry, that address could not be found.\",\r\n        searchLabel: \"البحث\",\r\n        style: \"bar\",\r\n      });\r\n      const map = new L.Map(\"leafletmap\");\r\n      map.addControl(searchControl);\r\n      map.on(\"geosearch/showlocation\", (e) => {\r\n        this.points = [e.location.y, e.location.x];\r\n        // remove the previous marker\r\n        map.eachLayer((layer) => {\r\n          if (layer instanceof L.Marker) {\r\n            map.removeLayer(layer);\r\n          }\r\n        });\r\n        this.findAddressByCoordinates();\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n</style>\r\n"],"names":["_sfc_main","LMap","LTileLayer","LMarker","event","provider","OpenStreetMapProvider","response","data","searchControl","GeoSearchControl","map","e","layer","_createElementBlock","$data","_createVNode","_component_l_map","$props","_normalizeStyle","$options","_withCtx","_component_l_tile_layer","_component_l_marker","_cache","$event"],"mappings":"4JAkCA,MAAKA,EAAU,CACb,MAAO,CACL,OAAQ,CACN,KAAM,MACN,QAAS,IAAM,CAAC,SAAU,SAAS,CACpC,EACD,MAAO,CACL,KAAM,OACN,QAAS,KAAO,CAAA,EACjB,EACD,KAAM,CACJ,KAAM,OACN,QAAS,EACV,EACD,WAAY,CACV,KAAM,QACN,QAAS,EACV,CACF,EACD,WAAY,MACVC,aACAC,EACA,QAAAC,CACD,EACD,MAAO,CACL,MAAO,CACL,OAAQ,CAAC,EAAG,CAAC,EACb,QAAS,CACP,MAAO,GACP,IAAK,GACL,KAAM,EACP,EAEJ,EACD,SAAU,CACR,KAAK,OAAS,KAAK,MACpB,EACD,SAAU,CACR,KAAK,UAAU,IAAM,CACf,KAAK,YACP,KAAK,gBAAe,CAExB,CAAC,CACF,EACD,SAAU,CACR,UAAW,CACT,MAAO,CACL,OAAQ,KAAK,MAAM,QAAU,QAC7B,MAAO,KAAK,MAAM,OAAS,OAE9B,CACF,EACD,QAAS,CACP,aAAaC,EAAO,CAClB,KAAK,OAAS,CAACA,EAAM,OAAO,QAAQ,IAAKA,EAAM,OAAO,QAAQ,GAAG,EACjE,KAAK,yBAAwB,CAC9B,EACD,0BAA2B,CACzB,MAAMC,EAAW,IAAIC,EACrB,MACE,GAAGD,EAAS,SAAS,MAAM,KAAK,OAAO,CAAC,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC,gCAC7D,EACG,KAAME,GAAaA,EAAS,KAAI,CAAE,EAClC,KAAMC,GAAS,CACd,KAAK,QAAU,CACb,MAAOA,EAAK,CAAC,GAAG,aAChB,IAAKA,EAAK,CAAC,GAAG,IACd,KAAMA,EAAK,CAAC,GAAG,KAEjB,KAAK,MAAM,cAAe,KAAK,OAAO,CACxC,CAAC,CACJ,EACD,iBAAkB,CAChB,MAAMH,EAAW,IAAIC,EAAsB,CACzC,OAAQ,CACN,aAAc,IACf,CACH,CAAC,EACKG,EAAgB,IAAIC,EAAiB,CACzC,SAAUL,EACV,gBAAiB,0CACjB,YAAa,QACb,MAAO,KACT,CAAC,EACKM,EAAM,IAAI,EAAE,IAAI,YAAY,EAClCA,EAAI,WAAWF,CAAa,EAC5BE,EAAI,GAAG,yBAA2BC,GAAM,CACtC,KAAK,OAAS,CAACA,EAAE,SAAS,EAAGA,EAAE,SAAS,CAAC,EAEzCD,EAAI,UAAWE,GAAU,CACnBA,aAAiB,EAAE,QACrBF,EAAI,YAAYE,CAAK,CAEzB,CAAC,EACD,KAAK,yBAAwB,CAC/B,CAAC,CACF,CACF,CACH,4FAnIEC,EAwBM,MAAA,CAvBJ,MAAM,0BACN,GAAG,aACF,IAAG,GAAKC,EAAM,OAAA,CAAA,CAAA,IAAOA,EAAM,OAAA,CAAA,CAAA,KAE5BC,EAkBQC,EAAA,CAjBN,IAAI,MACH,KAAMC,EAAI,KACV,OAAQH,EAAM,OACd,iBAAgB,GAChB,MAXPI,EAWcC,EAAQ,QAAA,IAXtB,QAAAC,EAaM,IAIgB,CAJhBL,EAIgBM,EAAA,CAHd,IAAI,qDACJ,aAAW,OACX,KAAK,kBAEPN,EAKYO,EAAA,CAJT,UAASR,EAAM,OACf,iBAAgB,GAChB,UAAWG,EAAU,WACrB,UAAOM,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAEL,EAAY,aAACK,CAAM,sCAtBrC,EAAA"}