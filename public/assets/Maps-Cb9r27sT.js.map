{"version":3,"file":"Maps-Cb9r27sT.js","sources":["../../src/components/common/Maps.vue"],"sourcesContent":["<template>\r\n  <div class=\"position-relative\" id=\"leafletmap\">\r\n    <l-map\r\n      ref=\"map\"\r\n      :zoom=\"zoom\"\r\n      :center=\"center\"\r\n      :global-leaflet=\"false\"\r\n      style=\"height: 400px\"\r\n    >\r\n      <l-tile-layer\r\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        layer-type=\"base\"\r\n        name=\"OpenStreetMap\"\r\n      ></l-tile-layer>\r\n      <l-marker\r\n        :lat-lng=\"center\"\r\n        :update:visible=\"true\"\r\n        draggable\r\n        @dragend=\"updateCenter($event)\"\r\n      ></l-marker>\r\n    </l-map>\r\n  </div>\r\n  <v-btn @click=\"getLocation\" fab color=\"primary\" class=\"mt-4\">\r\n    <v-icon size=\"24\"> mdi mdi-crosshairs-gps</v-icon>\r\n  </v-btn>\r\n</template>\r\n<script >\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport \"leaflet-geosearch/dist/geosearch.css\";\r\n\r\nimport { LMap, LTileLayer, LMarker } from \"@vue-leaflet/vue-leaflet\";\r\nimport { GeoSearchControl, OpenStreetMapProvider } from \"leaflet-geosearch\";\r\nimport L from \"leaflet\";\r\n\r\nexport default {\r\n  props: {\r\n    editMode: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    lat: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n    long: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n  },\r\n  components: {\r\n    LMap,\r\n    LTileLayer,\r\n    LMarker,\r\n  },\r\n  data() {\r\n    return {\r\n      center: [47.41322, -1.219482],\r\n      zoom: 14,\r\n      address: {\r\n        title: \"\",\r\n        lat: null,\r\n        long: null,\r\n      },\r\n    };\r\n  },\r\n  mounted() {\r\n    this.$nextTick(() => {\r\n      this.initMap();\r\n    });\r\n    if (this.editMode) {\r\n      this.center = [this.lat, this.long];\r\n    } else {\r\n      this.getLocation();\r\n    }\r\n  },\r\n  methods: {\r\n    getLocation() {\r\n      if (navigator.geolocation) {\r\n        navigator.geolocation.getCurrentPosition((position) => {\r\n          this.center = [position.coords.latitude, position.coords.longitude];\r\n          this.findAddressByCoordinates();\r\n        });\r\n      }\r\n    },\r\n    updateCenter(event) {\r\n      this.center = [event.target._latlng.lat, event.target._latlng.lng];\r\n      this.findAddressByCoordinates();\r\n    },\r\n    searchLocation(text) {\r\n      const provider = new OpenStreetMapProvider();\r\n      provider.search({ query: text }).then((results) => {\r\n        const findAddress = results.find((result) =>\r\n          result.label.includes(text)\r\n        );\r\n        this.address = {\r\n          title: findAddress?.raw?.display_name || findAddress?.label,\r\n          lat: findAddress?.raw?.lat || findAddress?.y,\r\n          long: findAddress?.raw?.lon || findAddress?.x,\r\n        };\r\n        this.$emit(\"getLocation\", this.address);\r\n      });\r\n    },\r\n    initMap() {\r\n      const provider = new OpenStreetMapProvider({\r\n        params: {\r\n          countrycodes: \"SA\",\r\n        },\r\n      });\r\n      const searchControl = new GeoSearchControl({\r\n        provider: provider,\r\n        notFoundMessage: \"Sorry, that address could not be found.\",\r\n        searchLabel: \"البحث\",\r\n        style: \"bar\",\r\n      });\r\n      const map = new L.Map(\"leafletmap\");\r\n      map.addControl(searchControl);\r\n      map.on(\"geosearch/showlocation\", (e) => {\r\n        this.center = [e.location.y, e.location.x];\r\n        // remove the previous marker\r\n        map.eachLayer((layer) => {\r\n          if (layer instanceof L.Marker) {\r\n            map.removeLayer(layer);\r\n          }\r\n        });\r\n        this.findAddressByCoordinates();\r\n      });\r\n    },\r\n    findAddressByCoordinates() {\r\n      const provider = new OpenStreetMapProvider();\r\n      fetch(\r\n        `${provider.searchUrl}?q=${this.center[0]},${this.center[1]}&polygon_geojson=1&format=json`\r\n      )\r\n        .then((response) => response.json())\r\n        .then((data) => {\r\n          this.address = {\r\n            title: data[0]?.display_name,\r\n            lat: data[0]?.lat,\r\n            long: data[0]?.lon,\r\n          };\r\n          this.$emit(\"getLocation\", this.address);\r\n        });\r\n    },\r\n  },\r\n  watch: {\r\n    center: {\r\n      handler() {\r\n        // if center changed, move the marker\r\n        this.findAddressByCoordinates();\r\n      },\r\n      deep: true,\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n</style>\r\n"],"names":["_sfc_main","LMap","LTileLayer","LMarker","position","event","text","OpenStreetMapProvider","results","findAddress","result","provider","searchControl","GeoSearchControl","map","L","e","layer","response","data","_openBlock","_createElementBlock","_Fragment","_createElementVNode","_hoisted_1","_createVNode","_component_l_map","$data","_withCtx","_component_l_tile_layer","_component_l_marker","_cache","$event","$options","_component_v_btn","_component_v_icon","_createTextVNode"],"mappings":"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"}